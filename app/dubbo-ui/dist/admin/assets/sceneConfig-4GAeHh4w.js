import{c as t,A as se,d as ae,n as O,e as c,o as u,f as $,t as a,J as j,B as F,v as p,h as k,a5 as G,a6 as ie,a7 as L,a8 as Q,F as q,y as W,z as N,K as C,a3 as Z,_ as ne,u as le,r as ue,Q as re,G as de,H as ce}from"./index-3yaHMBuR.js";import{c as ve,d as me,e as pe,f as _e,u as fe,h as ge,i as ye,j as be}from"./service-LxFxzmO_.js";import"./request-8fqjBntA.js";var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};const ke=he;function ee(f){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?Object(arguments[r]):{},I=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(I=I.concat(Object.getOwnPropertySymbols(s).filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable}))),I.forEach(function(o){Ie(f,o,s[o])})}return f}function Ie(f,r,s){return r in f?Object.defineProperty(f,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):f[r]=s,f}var X=function(r,s){var I=ee({},r,s.attrs);return t(se,ee({},I,{icon:ke}),null)};X.displayName="MinusOutlined";X.inheritAttrs=!1;const te=X,Pe={class:"__container_services_tabs_param_route"},we=ae({__name:"paramRoute",props:{paramRouteForm:{type:Object,default:()=>{}},index:{type:Number}},emits:["deleteParamRoute","update"],setup(f,{emit:r}){const s=O(!1),I=()=>{s.value=!0},o=r,P=f,i=O({method:{value:void 0,selectArr:[{label:"getUserInfo",value:"getUserInfo"},{label:"register",value:"register"},{label:"login",value:"login"}]},functionParams:[],destination:[]}),U=()=>{s.value=!1;let h=JSON.parse(JSON.stringify(P.paramRouteForm));i.value={method:{value:h.method,selectArr:[{label:"getUserInfo",value:"getUserInfo"},{label:"register",value:"register"},{label:"login",value:"login"}]},functionParams:h.conditions,destination:h.destinations}};U();const M=()=>{s.value=!1,o("update",P.index,i.value)},w=[{title:"参数索引",key:"index",dataIndex:"index",width:"30%"},{title:"关系",key:"relation",dataIndex:"relation",width:"30%"},{title:"值",key:"value",dataIndex:"value",width:"30%"},{title:"操作",key:"handle",dataIndex:"handle",width:"10%"}],V=[{title:"标签",key:"tag",dataIndex:"tag",width:"25%"},{title:"关系",key:"relation",dataIndex:"relation",width:"25%"},{title:"值",key:"value",dataIndex:"value",width:"25%"},{title:"操作",key:"handle",dataIndex:"handle",width:"10%"}],z=()=>{i.value.functionParams.push({index:"",relation:"",value:""})},D=h=>{i.value.functionParams.splice(h,1)},J=()=>{i.value.destination.push({conditions:[{tag:"",relation:"",value:""}],weight:0})},A=h=>{i.value.destination[h].conditions.push({tag:"",relation:"",value:""})},T=h=>{i.value.destination.splice(h,1)};return(h,R)=>{const S=c("a-flex"),K=c("a-select-option"),B=c("a-select"),E=c("a-form-item"),n=c("a-button"),e=c("a-input"),l=c("a-table"),_=c("a-space"),g=c("a-card"),v=c("a-form");return u(),$("div",Pe,[t(g,{bordered:!1,style:{width:"1000px"}},{title:a(()=>[t(S,{justify:"space-between"},{default:a(()=>[j("span",null,"路由"+F((P==null?void 0:P.index)+1),1),s.value?(u(),p(S,{key:1,class:"handle-form"},{default:a(()=>[t(k(L),{onClick:M,class:"edit-icon"}),t(k(Q),{onClick:U,class:"edit-icon"})]),_:1})):(u(),p(S,{key:0,class:"handle-form"},{default:a(()=>[t(k(G),{onClick:I,class:"edit-icon"}),t(k(ie),{onClick:R[0]||(R[0]=m=>o("deleteParamRoute",P.index)),class:"edit-icon"})]),_:1}))]),_:1})]),default:a(()=>[t(v,{labelCol:{span:3},disabled:!s.value},{default:a(()=>[t(E,{label:"选择方法"},{default:a(()=>[t(B,{value:i.value.method.value,"onUpdate:value":R[1]||(R[1]=m=>i.value.method.value=m),style:{width:"200px"}},{default:a(()=>[(u(!0),$(q,null,W(i.value.method.selectArr,(m,y)=>(u(),p(K,{value:m.value,key:y},{default:a(()=>[N(F(m.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(E,{label:"指定方法参数"},{default:a(()=>[t(_,{direction:"vertical"},{default:a(()=>[t(n,{type:"primary",onClick:z,disabled:!s.value},{default:a(()=>[N(" 添加参数 ")]),_:1},8,["disabled"]),t(l,{columns:w,"data-source":i.value.functionParams,pagination:!1},{bodyCell:a(({column:m,index:y})=>[m.dataIndex==="index"?(u(),p(e,{key:0,value:i.value.functionParams[y].index,"onUpdate:value":b=>i.value.functionParams[y].index=b},null,8,["value","onUpdate:value"])):C("",!0),m.dataIndex==="relation"?(u(),p(e,{key:1,value:i.value.functionParams[y].relation,"onUpdate:value":b=>i.value.functionParams[y].relation=b},null,8,["value","onUpdate:value"])):C("",!0),m.dataIndex==="value"?(u(),p(e,{key:2,value:i.value.functionParams[y].value,"onUpdate:value":b=>i.value.functionParams[y].value=b},null,8,["value","onUpdate:value"])):C("",!0),m.dataIndex==="handle"?(u(),p(S,{key:3,justify:"space-between"},{default:a(()=>[t(k(te),{class:Z(["edit-icon",{"disabled-icon":!s.value||i.value.functionParams.length===1}]),onClick:b=>s.value&&i.value.functionParams.length!==1&&D(P.index,y)},null,8,["class","onClick"])]),_:2},1024)):C("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1}),t(E,{label:"路由目的地"},{default:a(()=>[t(_,{direction:"vertical"},{default:a(()=>[t(n,{type:"primary",onClick:J},{default:a(()=>[N(" 添加目的地 ")]),_:1}),(u(!0),$(q,null,W(i.value.destination,(m,y)=>(u(),p(g,{bordered:!1},{title:a(()=>[t(_,null,{default:a(()=>[N(" 目的地"+F(y+1)+" ",1),t(n,{type:"primary",onClick:b=>A(y)},{default:a(()=>[N(" 添加条件 ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[t(l,{columns:V,"data-source":m.conditions,pagination:!1},{bodyCell:a(({column:b,index:H,record:x})=>[b.dataIndex==="tag"?(u(),p(e,{key:0,value:x.tag,"onUpdate:value":d=>x.tag=d},null,8,["value","onUpdate:value"])):C("",!0),b.dataIndex==="relation"?(u(),p(e,{key:1,value:x.relation,"onUpdate:value":d=>x.relation=d},null,8,["value","onUpdate:value"])):C("",!0),b.dataIndex==="value"?(u(),p(e,{key:2,value:x.value,"onUpdate:value":d=>x.value=d},null,8,["value","onUpdate:value"])):C("",!0),b.dataIndex==="handle"?(u(),p(S,{key:3,justify:"space-between"},{default:a(()=>[t(k(te),{class:Z(["edit-icon",{"disabled-icon":!s.value||i.value.functionParams.length===1}]),onClick:d=>s.value&&i.value.functionParams.length!==1&&T(H)},null,8,["class","onClick"])]),_:2},1024)):C("",!0)]),_:2},1032,["data-source"])]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1})])}}}),xe=ne(we,[["__scopeId","data-v-aeae6d4f"]]),oe=f=>(de("data-v-f1e11b58"),f=f(),ce(),f),Ce={class:"__container_services_tabs_scene_config"},Ne={class:"item-content"},Re=oe(()=>j("span",{style:{"margin-left":"5px"}},"ms",-1)),Se={class:"item-content"},Oe=oe(()=>j("span",{style:{"margin-left":"5px"}},"次",-1)),Ue=ae({__name:"sceneConfig",setup(f){const r=le(),s=O(1e3),I=O(1e3),o=ue({timeout:{isEdit:!1,value:""},retryNum:{isEdit:!1,value:""},sameArea:{value:!1}}),P=O("timeout"),i=n=>{switch(o[n].isEdit=!0,n){case"timeout":o[n].value=s.value;break;case"retryNum":o[n].value=I.value;break}},U=async n=>{switch(n){case"timeout":{await h(),await T();break}case"retryNum":{await S(),await R();break}}o[n].isEdit=!1},M=n=>{switch(o[n].isEdit=!1,n){case"timeout":s.value=o[n].value;break}},w=O([{method:"string",conditions:[{index:"string",relation:"string",value:"string"}],destinations:[{conditions:[{tag:"string",relation:"string",value:"string"}],weight:0}]}]),V=()=>{w.value.push({method:"string",conditions:[{index:"string",relation:"string",value:"string"}],destinations:[{conditions:[{tag:"string",relation:"string",value:"string"}],weight:0}]}),D(),A()},z=(n,e)=>{const l={conditions:e.functionParams,destinations:e.destination,method:e.method.value};w.value[n]=l,console.log(w.value),D(),A()},D=async()=>{const{pathId:n,group:e,version:l}=r.params;await fe({serviceName:n,group:e||"",version:l||"",routes:w.value})},J=n=>{w.value.splice(n,1)},A=async()=>{var v;const{pathId:n,group:e,version:l}=r.params,g=await ve({serviceName:n,group:e,version:l});g.code===200&&(w.value=(v=g.data)==null?void 0:v.routes)},T=async()=>{var v;const{pathId:n,group:e,version:l}=r.params,g=await me({serviceName:n,group:e||"",version:l||""});s.value=(v=g.data)==null?void 0:v.timeout},h=async()=>{const{pathId:n,group:e,version:l}=r.params,_={serviceName:n,group:e||"",version:l||"",timeout:parseInt(o.timeout.value)};await ge(_)},R=async()=>{var v;const{pathId:n,group:e,version:l}=r.params,g=await pe({serviceName:n,group:e||"",version:l||""});I.value=(v=g.data)==null?void 0:v.retryTimes},S=async()=>{const{pathId:n,group:e,version:l}=r.params,_={serviceName:n,group:e||"",version:l||"",retryTimes:parseInt(o.retryNum.value)};await ye(_)},K=async n=>{o.sameArea.value=n.target.value,await E(),await B()},B=async()=>{var v;const{pathId:n,group:e,version:l}=r.params,g=await _e({serviceName:n,group:e||"",version:l||""});o.sameArea.value=(v=g.data)==null?void 0:v.enabled},E=async()=>{const{pathId:n,group:e,version:l}=r.params,_={serviceName:n,group:e||"",version:l||"",enabled:o.sameArea.value};await be(_)};return re(async()=>{await T(),await R(),await B(),await A()}),(n,e)=>{const l=c("a-flex"),_=c("a-input-number"),g=c("a-descriptions-item"),v=c("a-descriptions"),m=c("a-tab-pane"),y=c("a-radio-button"),b=c("a-radio-group"),H=c("a-button"),x=c("a-tabs");return u(),$("div",Ce,[t(x,{activeKey:P.value,"onUpdate:activeKey":e[8]||(e[8]=d=>P.value=d),"tab-position":"left",animated:""},{default:a(()=>[t(m,{key:"timeout",tab:"超时时间"},{default:a(()=>[t(v,{layout:"vertical"},{default:a(()=>[t(g,{label:"超时时间"},{default:a(()=>[o.timeout.isEdit?(u(),p(l,{key:1,align:"center"},{default:a(()=>[t(_,{min:"0",value:o.timeout.value,"onUpdate:value":e[1]||(e[1]=d=>o.timeout.value=d),class:"item-input"},null,8,["value"]),Re,t(k(L),{onClick:e[2]||(e[2]=d=>U("timeout")),class:"item-icon"}),t(k(Q),{onClick:e[3]||(e[3]=d=>M("timeout")),class:"item-icon"})]),_:1})):(u(),p(l,{key:0},{default:a(()=>[j("span",Ne,F(s.value)+"ms",1),t(k(G),{onClick:e[0]||(e[0]=d=>i("timeout")),class:"item-icon"})]),_:1}))]),_:1})]),_:1})]),_:1}),t(m,{key:"retryNum",tab:"重试次数"},{default:a(()=>[t(v,{layout:"vertical"},{default:a(()=>[t(g,{label:"重试次数"},{default:a(()=>[o.retryNum.isEdit?(u(),p(l,{key:1,align:"center"},{default:a(()=>[t(_,{min:"0",value:o.retryNum.value,"onUpdate:value":e[5]||(e[5]=d=>o.retryNum.value=d),class:"item-input"},null,8,["value"]),Oe,t(k(L),{onClick:e[6]||(e[6]=d=>U("retryNum")),class:"item-icon"}),t(k(Q),{onClick:e[7]||(e[7]=d=>M("retryNum")),class:"item-icon"})]),_:1})):(u(),p(l,{key:0},{default:a(()=>[j("span",Se,F(I.value)+"次",1),t(k(G),{onClick:e[4]||(e[4]=d=>i("retryNum")),class:"item-icon"})]),_:1}))]),_:1})]),_:1})]),_:1}),t(m,{key:"sameArea",tab:"同区域优先"},{default:a(()=>[t(v,{layout:"vertical"},{default:a(()=>[t(g,{label:"同区域优先"},{default:a(()=>[t(b,{onChange:K,value:o.sameArea.value,"button-style":"solid"},{default:a(()=>[t(y,{value:!1},{default:a(()=>[N("关闭")]),_:1}),t(y,{value:!0},{default:a(()=>[N("开启")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(m,{key:"paramRoute",tab:"参数路由"},{default:a(()=>[(u(!0),$(q,null,W(w.value,(d,Y)=>(u(),p(xe,{class:"param-route",key:Y,paramRouteForm:d,index:Y,onUpdate:z,onDeleteParamRoute:J},null,8,["paramRouteForm","index"]))),128)),t(H,{type:"primary",style:{"margin-top":"20px"},onClick:V},{default:a(()=>[N("增加路由")]),_:1})]),_:1})]),_:1},8,["activeKey"])])}}}),Fe=ne(Ue,[["__scopeId","data-v-f1e11b58"]]);export{Fe as default};
