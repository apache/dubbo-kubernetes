import{_ as L}from"./MonacoEditor.vue_vue_type_script_setup_true_lang-VyJUwte-.js";import{d as R,u as K,n as r,l as P,m as q,Q as z,a as G,r as N,b as H,f as D,c as a,t as e,v as O,K as b,F as B,e as d,o as y,J as I,y as Q,z as v,X as g,a0 as U,G as X,H as $,_ as W}from"./index-3yaHMBuR.js";import{k as Z,l as aa,m as ea}from"./traffic-kHQqjcnF.js";import{y as V}from"./js-yaml-lTHa-xT-.js";import{V as ta}from"./ConfigModel-pnFsnDIc.js";import"./request-8fqjBntA.js";const F=m=>(X("data-v-68fde8b4"),m=m(),$(),m),sa={class:"editorBox"},na=F(()=>I("p",null,"修改时间: 2024/3/20 15:20:31",-1)),oa=F(()=>I("p",null,"版本号: xo842xqpx834",-1)),la=R({__name:"YAMLView",setup(m){const _=K(),C=r(_.params.isEdit==="1"),h=r(!1),f=r(!1),A=r(8),p=P(q.PROVIDE_INJECT_KEY),u=r(),k=r(),S=r("");z(async()=>{await E()}),G(()=>k.value!==JSON.stringify(u.value));const t=N(new ta);async function E(){var s,l,i;if((s=p.dynamicConfigForm)!=null&&s.data)t.fromData(p.dynamicConfigForm.data);else{if(((l=_.params)==null?void 0:l.pathId)==="_tmp")C.value=!0,t.isAdd=!0;else{t.isAdd=!1;const c=await Z({name:(i=_.params)==null?void 0:i.pathId});t.fromApiOutput(c.data)}p.dynamicConfigForm=N({data:t})}const n=t.toApiInput();S.value=n.ruleName,n.ruleName=void 0;const o=V.dump(n);k.value=JSON.stringify(o),u.value=o}async function T(){f.value=!0;try{p.dynamicConfigForm.data=null,await E(),g.success("config reset success")}finally{f.value=!1}}const J=H();async function M(){var o;f.value=!0;let n=V.load(u.value);try{if(t.isAdd===!0){aa({name:t.basicInfo.key+".configurators"},n).then(l=>{p.dynamicConfigForm.data=null,U(()=>{J.replace("/traffic/dynamicConfig"),g.success("config add success")})}).catch(l=>{g.error("添加失败： "+l.msg)});return}let s=await ea({name:(o=_.params)==null?void 0:o.pathId},n);t.fromApiOutput(s.data),g.success("config save success")}finally{f.value=!1}}function Y(n){t.fromApiOutput(V.load(u.value))}return(n,o)=>{const s=d("a-col"),l=d("a-row"),i=d("a-flex"),c=d("a-button"),x=d("a-card"),j=d("a-spin");return y(),D(B,null,[a(x,null,{default:e(()=>[a(j,{spinning:f.value},{default:e(()=>[a(i,{style:{width:"100%"}},{default:e(()=>[a(s,{span:h.value?24-A.value:24,class:"left"},{default:e(()=>[a(i,{vertical:"",align:"end"},{default:e(()=>[a(l,{style:{width:"100%"},justify:"space-between"},{default:e(()=>[a(s,{span:12}),a(s,{span:12})]),_:1}),I("div",sa,[a(L,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=w=>u.value=w),onChange:Y,theme:"vs-dark",height:"calc(100vh - 450px)",language:"yaml",readonly:!C.value},null,8,["modelValue","readonly"])])]),_:1})]),_:1},8,["span"]),a(s,{span:h.value?A.value:0,class:"right"},{default:e(()=>[h.value?(y(),O(x,{key:0,class:"sliderBox"},{default:e(()=>[(y(),D(B,null,Q(2,w=>a(x,{key:w},{default:e(()=>[na,oa,a(i,{justify:"flex-end"},{default:e(()=>[a(c,{type:"text",style:{color:"#0a90d5"}},{default:e(()=>[v("查看")]),_:1}),a(c,{type:"text",style:{color:"#0a90d5"}},{default:e(()=>[v("回滚")]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):b("",!0)]),_:1},8,["span"])]),_:1})]),_:1},8,["spinning"])]),_:1}),C.value?(y(),O(i,{key:0,style:{"margin-top":"30px"}},{default:e(()=>[a(c,{type:"primary",onClick:M},{default:e(()=>[v("保存")]),_:1}),a(c,{style:{"margin-left":"30px"},onClick:T},{default:e(()=>[v("重置")]),_:1})]),_:1})):b("",!0)],64)}}}),pa=W(la,[["__scopeId","data-v-68fde8b4"]]);export{pa as default};
