import{u as te}from"./index-37m6CaHp.js";import{d as oe,g as ne,u as se,n as k,b as ue,r as ie,f as L,c as e,t as a,e as t,o as s,z as n,v as r,h as S,a9 as de,aa as ce,F as re,y as pe,J as p,B as q,I as P,K as $,G as _e,H as fe,_ as ve}from"./index-WfxyH1kR.js";import{f as ye}from"./traffic-jiWu3d0C.js";import"./request-2cLtQ4vm.js";const g=B=>(_e("data-v-fb87ad39"),B=B(),fe(),B),be={class:"__container_tagRule_detail"},me=g(()=>p("div",null," 对于服务org.apahe.dubbo.samples.UserService，将满足请求方法等于login，且该方法的第一个参数等于dubbo的请求，导向带有标签version=v1的实例 ",-1)),he=g(()=>p("br",null,null,-1)),ke=g(()=>p("br",null,null,-1)),ge=g(()=>p("br",null,null,-1)),xe=g(()=>p("br",null,null,-1)),we=g(()=>p("br",null,null,-1)),Ce=g(()=>p("br",null,null,-1)),Ue={class:"bottom-action-footer"},Oe=oe({__name:"addByFormView",setup(B){ne(),se();const x=k(!1),A=k(8);te().toClipboard;const F=ue(),u=ie({ruleGranularity:"application",objectOfAction:"",enable:!0,faultTolerantProtection:!0,runtime:!0,priority:1,configVersion:"v3.0"}),E=k([{label:"labels",value:"labels"},{label:"addresses",value:"addresses"}]),G=k([{label:"exact",value:"exact"},{label:"regex",value:"regex"},{label:"prefix",value:"prefix"},{label:"noempty",value:"noempty"},{label:"empty",value:"empty"},{label:"wildcard",value:"wildcard"}]),H=k([{label:"=",value:"="},{label:"!=",value:"!="}]),J=k([{title:"键",dataIndex:"myKey",key:"myKey"},{title:"关系",dataIndex:"condition",key:"condition"},{title:"值",dataIndex:"value",key:"value"},{title:"操作",dataIndex:"operation",key:"operation"}]),_=k([]),M=(i,o)=>{if(_.value[i].scope.labels.length===1){_.value[i].scope.type="addresses";return}_.value[i].scope.labels.splice(o,1)},Q=i=>{_.value[i].scope.labels.push({myKey:"",condition:"exact",value:""})},W=()=>{_.value.push({tagName:"",scope:{type:"labels",labels:[{myKey:"",condition:"",value:""}],addresses:{condition:"",addressesStr:""}}})},X=i=>{_.value.splice(i,1)},Y=async()=>{const{ruleGranularity:i,objectOfAction:o,enable:w,faultTolerantProtection:R,runtime:d,priority:V,configVersion:v}=u,y={configVersion:v,scope:i,key:o,enabled:w,runtime:d,tags:[]};_.value.forEach((O,b)=>{const c={name:O.tagName,match:[]};O.scope.labels.forEach((T,D)=>{const K={key:T.myKey,value:{}};K.value[T.condition]=T.value,c.match.push(K)}),y.tags.push(c)});let U="";i=="application"?U=`${o}.tag-router`:U=`${o}:${v}.tag-router`,(await ye(U,y)).code===200&&F.push("/traffic/tagRule")};return(i,o)=>{const w=t("a-button"),R=t("a-flex"),d=t("a-form-item"),V=t("a-switch"),v=t("a-col"),y=t("a-input"),U=t("a-input-number"),j=t("a-row"),O=t("a-form"),b=t("a-card"),c=t("a-space"),T=t("a-radio-group"),D=t("a-tag"),K=t("a-select"),Z=t("a-table"),I=t("a-textarea"),z=t("a-descriptions-item"),ee=t("a-descriptions"),ae=t("a-affix");return s(),L("div",be,[e(R,{style:{width:"100%"}},{default:a(()=>[e(v,{span:x.value?24-A.value:24,class:"left"},{default:a(()=>[e(b,null,{default:a(()=>[e(c,{style:{width:"100%"},direction:"vertical",size:"middle"},{default:a(()=>[e(j,null,{default:a(()=>[e(R,{justify:"end",style:{width:"100%"}},{default:a(()=>[e(w,{type:"text",style:{color:"#0a90d5"},onClick:o[0]||(o[0]=l=>x.value=!x.value)},{default:a(()=>[n(" 字段说明 "),x.value?(s(),r(S(ce),{key:1})):(s(),r(S(de),{key:0}))]),_:1})]),_:1}),e(b,{title:"基础信息",style:{width:"100%"},class:"_detail"},{default:a(()=>[e(O,{layout:"horizontal"},{default:a(()=>[e(j,{style:{width:"100%"}},{default:a(()=>[e(v,{span:12},{default:a(()=>[e(d,{label:"规则粒度",required:""},{default:a(()=>[n(" 应用 ")]),_:1}),e(d,{label:"容错保护"},{default:a(()=>[e(V,{checked:u.faultTolerantProtection,"onUpdate:checked":o[1]||(o[1]=l=>u.faultTolerantProtection=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(d,{label:"运行时生效"},{default:a(()=>[e(V,{checked:u.runtime,"onUpdate:checked":o[2]||(o[2]=l=>u.runtime=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1}),e(v,{span:12},{default:a(()=>[e(d,{label:"作用对象",required:""},{default:a(()=>[e(y,{value:u.objectOfAction,"onUpdate:value":o[3]||(o[3]=l=>u.objectOfAction=l),style:{width:"200px"}},null,8,["value"])]),_:1}),e(d,{label:"立即启用"},{default:a(()=>[e(V,{checked:u.enable,"onUpdate:checked":o[4]||(o[4]=l=>u.enable=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(d,{label:"优先级"},{default:a(()=>[e(U,{min:"1",value:u.priority,"onUpdate:value":o[5]||(o[5]=l=>u.priority=l)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(b,{title:"标签列表",style:{width:"100%"},class:"_detail"},{default:a(()=>[(s(!0),L(re,null,pe(_.value,(l,N)=>(s(),r(b,{key:N},{title:a(()=>[e(c,{align:"center"},{default:a(()=>[p("div",null,"路由【"+q(N+1)+"】",1),me]),_:2},1024)]),default:a(()=>[e(O,{layout:"horizontal"},{default:a(()=>[e(c,{style:{width:"100%"},direction:"vertical",size:"large"},{default:a(()=>[e(R,{justify:"end"},{default:a(()=>[e(S(P),{onClick:m=>X(N),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024),e(d,{label:"标签名",required:""},{default:a(()=>[e(y,{placeholder:"隔离环境名",value:l.tagName,"onUpdate:value":m=>l.tagName=m},null,8,["value","onUpdate:value"])]),_:2},1024),e(d,{label:"作用范围",required:""},{default:a(()=>[e(b,null,{default:a(()=>[e(c,{style:{width:"100%"},direction:"vertical"},{default:a(()=>[e(d,{label:"匹配条件类型"},{default:a(()=>[e(T,{value:l.scope.type,"onUpdate:value":m=>l.scope.type=m,options:E.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(c,{align:"start",style:{width:"100%"},direction:"horizontal"},{default:a(()=>{var m;return[e(D,{bordered:!1,color:"processing"},{default:a(()=>[n(q(l.scope.type),1)]),_:2},1024),l.scope.type==="labels"?(s(),r(Z,{key:0,pagination:!1,columns:J.value,"data-source":(m=l.scope)==null?void 0:m.labels},{bodyCell:a(({column:f,record:C,text:Te,index:le})=>[f.key==="myKey"?(s(),r(y,{key:0,placeholder:"label key",value:C.myKey,"onUpdate:value":h=>C.myKey=h},null,8,["value","onUpdate:value"])):$("",!0),f.key==="condition"?(s(),r(K,{key:1,value:C.condition,"onUpdate:value":h=>C.condition=h,style:{width:"120px"},options:G.value},null,8,["value","onUpdate:value","options"])):$("",!0),f.key==="value"?(s(),r(y,{key:2,placeholder:"label value",value:C.value,"onUpdate:value":h=>C.value=h},null,8,["value","onUpdate:value"])):f.key==="operation"?(s(),r(c,{key:3,align:"center"},{default:a(()=>[e(S(P),{icon:"tdesign:remove",class:"action-icon",onClick:h=>M(N,le)},null,8,["onClick"]),e(S(P),{class:"action-icon",icon:"tdesign:add",onClick:h=>Q(N)},null,8,["onClick"])]),_:2},1024)):$("",!0)]),_:2},1032,["columns","data-source"])):(s(),r(c,{key:1,align:"start"},{default:a(()=>[e(K,{style:{width:"120px"},value:l.scope.addresses.condition,"onUpdate:value":f=>l.scope.addresses.condition=f,options:H.value},null,8,["value","onUpdate:value","options"]),e(I,{style:{width:"500px"},value:l.scope.addresses.addressesStr,"onUpdate:value":f=>l.scope.addresses.addressesStr=f,placeholder:'地址列表，如有多个用"，"隔开'},null,8,["value","onUpdate:value"])]),_:2},1024))]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(w,{onClick:W,type:"primary"},{default:a(()=>[n(" 增加标签")]),_:1})]),_:1})]),_:1})]),_:1},8,["span"]),e(v,{span:x.value?A.value:0,class:"right"},{default:a(()=>[x.value?(s(),r(b,{key:0,class:"sliderBox"},{default:a(()=>[p("div",null,[e(ee,{title:"字段说明",column:1},{default:a(()=>[e(z,{label:"key"},{default:a(()=>[n(" 作用对象"),he,n(" 可能的值：Dubbo应用名或者服务名 ")]),_:1}),e(z,{label:"scope"},{default:a(()=>[n(" 规则粒度"),ke,n(" 可能的值：application, service ")]),_:1}),e(z,{label:"force"},{default:a(()=>[n(" 容错保护"),ge,n(" 可能的值：true, false"),xe,n(" 描述：如果为true，则路由筛选后若没有可用的地址则会直接报异常；如果为false，则会从可用地址中选择完成RPC调用 ")]),_:1}),e(z,{label:"runtime"},{default:a(()=>[n(" 运行时生效"),we,n(" 可能的值：true, false"),Ce,n(" 描述：如果为true，则该rule下的所有路由将会实时生效；若为false，则只有在启动时才会生效 ")]),_:1})]),_:1})])]),_:1})):$("",!0)]),_:1},8,["span"])]),_:1}),e(ae,{"offset-bottom":10},{default:a(()=>[p("div",Ue,[e(c,{align:"center",size:"large"},{default:a(()=>[e(w,{type:"primary",onClick:Y},{default:a(()=>[n(" 确认")]),_:1}),e(w,null,{default:a(()=>[n(" 取消")]),_:1})]),_:1})])]),_:1})])}}}),Re=ve(Oe,[["__scopeId","data-v-fb87ad39"]]);export{Re as default};
