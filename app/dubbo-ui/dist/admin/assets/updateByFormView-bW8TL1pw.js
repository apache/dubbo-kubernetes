import{u as Te}from"./index-DoPOcYH8.js";import{d as Ue,g as we,u as De,n as m,r as Re,Q as Ke,f as x,c as e,t as l,e as q,o as h,z as g,v as _,h as S,a9 as Oe,aa as qe,K as j,F as L,y as X,J as G,B as A,I as E,G as je,H as Se,_ as Ae}from"./index-_X3VxdTR.js";import{g as Ee,u as ze}from"./traffic-tUIc0SS0.js";import"./request-da1buChK.js";const F=H=>(je("data-v-35945e06"),H=H(),Se(),H),Ve={class:"__container_routingRule_detail"},Be={style:{"max-width":"400px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Ge=F(()=>G("br",null,null,-1)),Pe=F(()=>G("br",null,null,-1)),We=F(()=>G("br",null,null,-1)),me=F(()=>G("br",null,null,-1)),Ne=F(()=>G("br",null,null,-1)),xe=F(()=>G("br",null,null,-1)),Fe=Ue({__name:"updateByFormView",setup(H){we();const J=De(),N=m(!1),Y=m(8);Te().toClipboard;const k=Re({version:"",ruleGranularity:"",objectOfAction:"",enable:!0,faultTolerantProtection:!1,runtime:!0,priority:null,group:""}),te=m([{label:"host",value:"host"},{label:"application",value:"application"},{label:"method",value:"method"},{label:"arguments",value:"arguments"},{label:"attachments",value:"attachments"},{label:"其他",value:"other"}]),le=m([{label:"host",value:"host"},{label:"其他",value:"other"}]),P=m([{label:"=",value:"="},{label:"!=",value:"!="}]),ae=m([{label:"应用",value:"application"},{label:"服务",value:"service"}]),r=m([{selectedMatchConditionTypes:[],requestMatch:[],selectedRouteDistributeMatchTypes:[],routeDistribute:[{type:"host",condition:"=",value:"127.0.0.1"},{type:"other",list:[{myKey:"key",condition:"=",value:"value"}]}]}]),ne=()=>{r.value.push({selectedMatchConditionTypes:[],requestMatch:[],selectedRouteDistributeMatchTypes:[],routeDistribute:[{type:"host",condition:"=",value:"127.0.0.1"},{type:"other",list:[{myKey:"key",condition:"=",value:"value"}]}]})},se=s=>{r.value.splice(s,1)},oe=s=>{r.value[s].requestMatch=[],r.value[s].selectedMatchConditionTypes=[]},ie=s=>{r.value[s].requestMatch=[{type:"host",condition:"",value:""},{type:"application",condition:"",value:""},{type:"method",condition:"",value:""},{type:"arguments",list:[{index:0,condition:"",value:""}]},{type:"attachments",list:[{myKey:"key",condition:"",value:""}]},{type:"other",list:[{myKey:"key",condition:"",value:""}]}]},Q=(s,t)=>{r.value[t].selectedMatchConditionTypes=r.value[t].selectedMatchConditionTypes.filter(i=>i!==s)},ue=(s,t)=>{r.value[t].selectedRouteDistributeMatchTypes=r.value[t].selectedRouteDistributeMatchTypes.filter(i=>i!==s)},ce=[{dataIndex:"index",key:"index",title:"参数索引"},{dataIndex:"condition",key:"condition",title:"关系"},{dataIndex:"value",key:"value",title:"值"},{dataIndex:"operation",key:"operation",title:"操作"}],de=(s,t)=>{r.value[s].requestMatch[t].list.push({index:0,condition:"=",value:""})},re=(s,t,i)=>{r.value[s].requestMatch[t].list.length===1&&(r.value[s].selectedMatchConditionTypes=r.value[s].selectedMatchConditionTypes.filter(f=>f!=="arguments")),r.value[s].requestMatch[t].list.splice(i,1)},pe=[{dataIndex:"myKey",key:"myKey",title:"键"},{dataIndex:"condition",key:"condition",title:"关系"},{dataIndex:"value",key:"value",title:"值"},{dataIndex:"operation",key:"operation",title:"操作"}],ve=(s,t)=>{r.value[s].requestMatch[t].list.push({key:"key",condition:"=",value:""})},ye=(s,t,i)=>{r.value[s].requestMatch[t].list.length===1&&(r.value[s].selectedMatchConditionTypes=r.value[s].selectedMatchConditionTypes.filter(f=>f!=="attachments")),r.value[s].requestMatch[t].list.splice(i,1)},Z=[{dataIndex:"myKey",key:"myKey",title:"键"},{dataIndex:"condition",key:"condition",title:"关系"},{dataIndex:"value",key:"value",title:"值"},{dataIndex:"operation",key:"operation",title:"操作"}],he=(s,t)=>{r.value[s].requestMatch[t].list.push({myKey:"",condition:"=",value:""})},fe=(s,t,i)=>{if(r.value[s].requestMatch[t].list.length===1){r.value[s].selectedMatchConditionTypes=r.value[s].selectedMatchConditionTypes.filter(f=>f!=="other");return}r.value[s].requestMatch[t].list.splice(i,1)},_e=(s,t)=>{r.value[s].routeDistribute[t].list.push({myKey:"",condition:"=",value:""})},ke=(s,t,i)=>{if(r.value[s].routeDistribute[t].list.length===1){r.value[s].selectedRouteDistributeMatchTypes=r.value[s].selectedRouteDistributeMatchTypes.filter(f=>f!=="other");return}r.value[s].routeDistribute[t].list.splice(i,1)},I=s=>{var v,w;const t=r.value[s],{ruleGranularity:i,objectOfAction:f}=k;let c=`对于${i==="service"?"服务":"应用"}【${f||"未指定"}】`,n=[];(v=t.selectedMatchConditionTypes)==null||v.forEach($=>{var V,W,p,b;const T=(V=t.requestMatch)==null?void 0:V.find(a=>a.type===$);if(!T)return;let y="";const O=T.condition==="="?"等于":T.condition==="!="?"不等于":T.condition||"",z=T.value||"未指定";switch($){case"host":y=`请求来源主机 ${O} ${z}`;break;case"application":y=`请求来源应用 ${O} ${z}`;break;case"method":y=`请求方法 ${O} ${z}`;break;case"arguments":const a=(W=T.list)==null?void 0:W.map(u=>{const B=u.condition==="="?"等于":u.condition==="!="?"不等于":u.condition||"",K=u.value!==void 0&&u.value!==""?u.value:"未指定";return`参数[${u.index}] ${B} ${K}`}).filter(Boolean);(a==null?void 0:a.length)>0&&(y=a.join(" 且 "));break;case"attachments":const U=(p=T.list)==null?void 0:p.map(u=>{const B=u.condition==="="?"等于":u.condition==="!="?"不等于":u.condition||"",K=u.value!==void 0&&u.value!==""?u.value:"未指定";return`附件[${u.myKey||"未指定"}] ${B} ${K}`}).filter(Boolean);(U==null?void 0:U.length)>0&&(y=U.join(" 且 "));break;case"other":const d=(b=T.list)==null?void 0:b.map(u=>{const B=u.condition==="="?"等于":u.condition==="!="?"不等于":u.condition||"",K=u.value!==void 0&&u.value!==""?u.value:"未指定";return`自定义匹配[${u.myKey||"未指定"}] ${B} ${K}`}).filter(Boolean);(d==null?void 0:d.length)>0&&(y=d.join(" 且 "));break}y&&(($==="host"||$==="application"||$==="method")&&!T.value?n.push(`${$==="host"?"请求来源主机":$==="application"?"请求来源应用":"请求方法"} 未填写`):n.push(y))});const C=n.length>0?n.join(" 且 "):"任意请求";let o=[];(w=t.selectedRouteDistributeMatchTypes)==null||w.forEach($=>{var V,W;const T=(V=t.routeDistribute)==null?void 0:V.find(p=>p.type===$);if(!T)return;let y="";const O=T.condition==="="?"等于":T.condition==="!="?"不等于":T.condition||"",z=T.value||"未指定";switch($){case"host":y=`目标主机 ${O} ${z}`;break;case"other":const p=(W=T.list)==null?void 0:W.map(b=>{const a=b.condition==="="?"等于":b.condition==="!="?"不等于":b.condition||"",U=b.value!==void 0&&b.value!==""?b.value:"未指定";return`目标标签[${b.myKey||"未指定"}] ${a} ${U}`}).filter(Boolean);(p==null?void 0:p.length)>0&&(y=p.join(" 且 "));break}y&&($==="host"&&!T.value?o.push("目标主机 未填写"):o.push(y))});const M=o.length>0?`满足 【${o.join(" 且 ")}】`:"默认路由规则";return`${c}，将满足 【${C}】 条件的请求，转发到 ${M} 的实例。`};function be(s,t){const i=[],f=s.split(" & ");return[{type:"host",condition:"",value:""},{type:"application",condition:"",value:""},{type:"method",condition:"",value:""},{type:"arguments",list:[]},{type:"attachments",list:[]},{type:"other",list:[]}].forEach(c=>i.push({...c})),f.forEach(c=>{if(c=c.trim(),c.startsWith("host")){r.value[t].selectedMatchConditionTypes.push("host");const n=c.match(/^host(!=|=)(.+)/);if(n){const C=n[1],o=n[2].trim(),M=i.find(v=>v.type==="host");M.condition=C,M.value=o}}else if(c.startsWith("application")){r.value[t].selectedMatchConditionTypes.push("application");const n=c.match(/^application(!=|=)(.+)/);if(n){const C=n[1],o=n[2].trim(),M=i.find(v=>v.type==="application");M.condition=C,M.value=o}}else if(c.startsWith("method")){r.value[t].selectedMatchConditionTypes.push("method");const n=c.match(/^method(!=|=)(.+)/);if(n){const C=n[1],o=n[2].trim(),M=i.find(v=>v.type==="method");M.condition=C,M.value=o}}else if(c.startsWith("arguments")){!r.value[t].selectedMatchConditionTypes.includes("arguments")&&r.value[t].selectedMatchConditionTypes.push("arguments");const n=c.match(/^arguments\[(\d+)\](!=|=)(.+)/);if(n){const C=parseInt(n[1],10),o=n[2],M=n[3].trim();i.find(w=>w.type==="arguments").list.push({index:C,condition:o,value:M})}}else if(c.startsWith("attachments")){!r.value[t].selectedMatchConditionTypes.includes("attachments")&&r.value[t].selectedMatchConditionTypes.push("attachments");const n=c.match(/^attachments\[(.+)\](!=|=)(.+)/);if(n){const C=n[1].trim(),o=n[2],M=n[3].trim();i.find(w=>w.type==="attachments").list.push({myKey:C,condition:o,value:M})}}else if(c.startsWith("other")){!r.value[t].selectedMatchConditionTypes.includes("other")&&r.value[t].selectedMatchConditionTypes.push("other");const n=c.match(/^other\[(.+)\](!=|=)(.+)/);if(n){const C=n[1].trim(),o=n[2],M=n[3].trim();i.find(w=>w.type==="other").list.push({myKey:C,condition:o,value:M})}}}),i}function ge(s,t){const i=[],f=s==null?void 0:s.split(" & ");return[{type:"host",condition:"",value:""},{type:"other",list:[]}].forEach(c=>i.push({...c})),f!=null&&f.length&&f.forEach(c=>{if(c=c.trim(),c.startsWith("host")){r.value[t].selectedRouteDistributeMatchTypes.push("host");const n=c.match(/^host(!=|=)(.+)/);if(n){const C=n[1],o=n[2].trim(),M=i.find(v=>v.type==="host");M.condition=C,M.value=o}}else if(c.startsWith("other")){!r.value[t].selectedRouteDistributeMatchTypes.includes("other")&&r.value[t].selectedRouteDistributeMatchTypes.push("other");const n=c.match(/^other\[(.+)\](!=|=)(.+)/);if(n){const C=n[1].trim(),o=n[2],M=n[3].trim();i.find(w=>w.type==="other").list.push({myKey:C,condition:o,value:M})}}}),i}async function ee(){var t;let s=await Ee((t=J.params)==null?void 0:t.ruleName);if((s==null?void 0:s.code)===200){console.log("res",s.data);const{conditions:i,configVersion:f,enabled:R,force:c,key:n,runtime:C,scope:o}=s==null?void 0:s.data;k.ruleGranularity=o,k.objectOfAction=n,k.enable=R,k.faultTolerantProtection=c,k.runtime=C,k.configVersion=f,f=="v3.0"&&i.forEach((M,v)=>{var y,O;const w=M.split("=>"),$=(y=w[0])==null?void 0:y.trim(),T=(O=w[1])==null?void 0:O.trim();r.value[v].requestMatch=be($,v),r.value[v].routeDistribute=ge(T,v)})}}function Ce(){let s=[],t="",i="";return r.value.forEach((f,R)=>{f.selectedMatchConditionTypes.forEach((n,C)=>{f.requestMatch.forEach((o,M)=>{if(n==(o==null?void 0:o.type))switch(o==null?void 0:o.type){case"arguments":o.list.forEach((v,w)=>{t.length>0&&(t+=" & "),t+=`${n}[${v.index}]${v.condition}${v.value}`});break;case"attachments":o.list.forEach((v,w)=>{t.length>0&&(t+=" & "),t+=`${n}[${v.myKey}]${v.condition}${v.value}`});break;case"other":o.list.forEach((v,w)=>{t.length>0&&(t+=" & "),t+=`${n}[${v.myKey}]${v.condition}${v.value}`});break;default:t.length>0&&(t+=" & "),t+=`${o.type}${o.condition}${o.value}`}})}),f.selectedRouteDistributeMatchTypes.forEach((n,C)=>{f.routeDistribute.forEach((o,M)=>{if(n==(o==null?void 0:o.type))switch(o==null?void 0:o.type){case"other":o==null||o.list.forEach((v,w)=>{i.length>0&&(i+=" & "),i+=`${n}[${v.myKey}]${v.condition}${v.value}`});break;default:i.length>0&&(i+=" & "),i+=`${o.type}${o.condition}${o.value}`}})});let c="";t.length>0&&i.length>0?c=`${t} => ${i}`:t.length>0&&i.length==0&&(c=`${t}`),s.push(c)}),s}const Me=async()=>{const{ruleName:s}=J.params,{version:t,ruleGranularity:i,objectOfAction:f,enable:R,faultTolerantProtection:c,runtime:n}=k,C={configVersion:"v3.0",scope:i,key:f,enabled:R,force:c,runtime:n,conditions:Ce()},o=await ze(s,C);(o==null?void 0:o.code)===200&&await ee()},$e=()=>{var t;const s=(t=J.params)==null?void 0:t.ruleName;if(s&&k.ruleGranularity==="service"){const i=s==null?void 0:s.split(":");k.version=i[1],k.group=i[2].split(".")[0]}};return Ke(async()=>{await ee(),$e()}),(s,t)=>{const i=q("a-button"),f=q("a-flex"),R=q("a-select"),c=q("a-form-item"),n=q("a-input"),C=q("a-switch"),o=q("a-col"),M=q("a-input-number"),v=q("a-row"),w=q("a-form"),$=q("a-card"),T=q("a-tooltip"),y=q("a-space"),O=q("a-tag"),z=q("a-table"),V=q("a-descriptions-item"),W=q("a-descriptions");return h(),x("div",Ve,[e(f,{style:{width:"100%"}},{default:l(()=>[e(o,{span:N.value?24-Y.value:24,class:"left"},{default:l(()=>[e($,null,{default:l(()=>[e(y,{style:{width:"100%"},direction:"vertical",size:"middle"},{default:l(()=>[e(v,null,{default:l(()=>[e(f,{justify:"end",style:{width:"100%"}},{default:l(()=>[e(i,{type:"text",style:{color:"#0a90d5"},onClick:t[0]||(t[0]=p=>N.value=!N.value)},{default:l(()=>[g(" 字段说明 "),N.value?(h(),_(S(qe),{key:1})):(h(),_(S(Oe),{key:0}))]),_:1})]),_:1}),e($,{title:"基础信息",style:{width:"100%"},class:"_detail"},{default:l(()=>[e(w,{layout:"horizontal"},{default:l(()=>[e(v,{style:{width:"100%"}},{default:l(()=>[e(o,{span:12},{default:l(()=>[e(c,{label:"规则粒度",required:""},{default:l(()=>[e(R,{disabled:"",value:k.ruleGranularity,"onUpdate:value":t[1]||(t[1]=p=>k.ruleGranularity=p),style:{width:"120px"},options:ae.value},null,8,["value","options"])]),_:1}),k.ruleGranularity==="service"?(h(),_(c,{key:0,label:"版本",required:""},{default:l(()=>[e(n,{value:k.version,"onUpdate:value":t[2]||(t[2]=p=>k.version=p),style:{width:"300px"},disabled:""},null,8,["value"])]),_:1})):j("",!0),e(c,{label:"容错保护"},{default:l(()=>[e(C,{checked:k.faultTolerantProtection,"onUpdate:checked":t[3]||(t[3]=p=>k.faultTolerantProtection=p),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(c,{label:"运行时生效"},{default:l(()=>[e(C,{checked:k.runtime,"onUpdate:checked":t[4]||(t[4]=p=>k.runtime=p),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1}),e(o,{span:12},{default:l(()=>[e(c,{label:"作用对象",required:""},{default:l(()=>[e(n,{disabled:"",value:k.objectOfAction,"onUpdate:value":t[5]||(t[5]=p=>k.objectOfAction=p),style:{width:"300px"}},null,8,["value"])]),_:1}),k.ruleGranularity==="service"?(h(),_(c,{key:0,label:"分组",required:""},{default:l(()=>[e(n,{value:k.group,"onUpdate:value":t[6]||(t[6]=p=>k.group=p),style:{width:"300px"},disabled:""},null,8,["value"])]),_:1})):j("",!0),e(c,{label:"立即启用"},{default:l(()=>[e(C,{checked:k.enable,"onUpdate:checked":t[7]||(t[7]=p=>k.enable=p),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(c,{label:"优先级"},{default:l(()=>[e(M,{value:k.priority,"onUpdate:value":t[8]||(t[8]=p=>k.priority=p),min:"1"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e($,{title:"路由列表",style:{width:"100%"},class:"_detail"},{default:l(()=>[(h(!0),x(L,null,X(r.value,(p,b)=>(h(),_($,null,{title:l(()=>[e(f,{justify:"space-between"},{default:l(()=>[e(y,{align:"center"},{default:l(()=>[G("div",null,"路由【"+A(b+1)+"】",1),e(T,null,{title:l(()=>[g(A(I(b)),1)]),default:l(()=>[G("div",Be,A(I(b)),1)]),_:2},1024)]),_:2},1024),e(S(E),{onClick:a=>se(b),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)]),default:l(()=>[e(w,{layout:"horizontal"},{default:l(()=>[e(y,{style:{width:"100%"},direction:"vertical",size:"large"},{default:l(()=>[e(c,{label:"请求匹配"},{default:l(()=>[p.requestMatch.length>0?(h(),_($,{key:0},{default:l(()=>[e(y,{style:{width:"100%"},direction:"vertical",size:"small"},{default:l(()=>[e(f,{align:"center",justify:"space-between"},{default:l(()=>[e(c,{label:"匹配条件类型"},{default:l(()=>[e(R,{value:p.selectedMatchConditionTypes,"onUpdate:value":a=>p.selectedMatchConditionTypes=a,options:te.value,mode:"multiple",style:{"min-width":"200px"}},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(S(E),{onClick:a=>oe(b),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024),(h(!0),x(L,null,X(p.requestMatch,(a,U)=>(h(),x(L,null,[p.selectedMatchConditionTypes.includes("host")&&a.type==="host"?(h(),_(y,{key:0,size:"large",align:"center"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A(a==null?void 0:a.type),1)]),_:2},1024),e(R,{value:a.condition,"onUpdate:value":d=>a.condition=d,style:{"min-width":"120px"},options:P.value},null,8,["value","onUpdate:value","options"]),e(n,{value:a.value,"onUpdate:value":d=>a.value=d,placeholder:"请求来源ip"},null,8,["value","onUpdate:value"]),e(S(E),{onClick:d=>Q(a==null?void 0:a.type,b),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),p.selectedMatchConditionTypes.includes("application")&&a.type==="application"?(h(),_(y,{key:1,size:"large",align:"center"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A(a==null?void 0:a.type),1)]),_:2},1024),e(R,{value:a.condition,"onUpdate:value":d=>a.condition=d,style:{"min-width":"120px"},options:P.value},null,8,["value","onUpdate:value","options"]),e(n,{value:a.value,"onUpdate:value":d=>a.value=d,placeholder:"请求来源应用名"},null,8,["value","onUpdate:value"]),e(S(E),{onClick:d=>Q(a==null?void 0:a.type,b),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),p.selectedMatchConditionTypes.includes("method")&&a.type==="method"?(h(),_(y,{key:2,size:"large",align:"center"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A(a==null?void 0:a.type),1)]),_:2},1024),e(R,{value:a.condition,"onUpdate:value":d=>a.condition=d,style:{"min-width":"120px"},options:P.value},null,8,["value","onUpdate:value","options"]),e(n,{value:a.value,"onUpdate:value":d=>a.value=d,placeholder:"方法值"},null,8,["value","onUpdate:value"]),e(S(E),{onClick:d=>Q(a==null?void 0:a.type,b),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),p.selectedMatchConditionTypes.includes("arguments")&&a.type==="arguments"?(h(),_(y,{key:3,style:{width:"100%"},size:"large",align:"start"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A(a==null?void 0:a.type),1)]),_:2},1024),e(y,{direction:"vertical"},{default:l(()=>[e(i,{type:"primary",onClick:d=>de(b,U)},{default:l(()=>[g(" 添加argument ")]),_:2},1032,["onClick"]),e(z,{pagination:!1,columns:ce,"data-source":p.requestMatch[U].list},{bodyCell:l(({column:d,record:u,text:B,index:K})=>[d.key==="index"?(h(),_(n,{key:0,value:u.index,"onUpdate:value":D=>u.index=D,placeholder:"index"},null,8,["value","onUpdate:value"])):d.key==="condition"?(h(),_(R,{key:1,value:u.condition,"onUpdate:value":D=>u.condition=D,options:P.value},null,8,["value","onUpdate:value","options"])):d.key==="value"?(h(),_(n,{key:2,value:u.value,"onUpdate:value":D=>u.value=D,placeholder:"value"},null,8,["value","onUpdate:value"])):d.key==="operation"?(h(),_(y,{key:3,align:"center"},{default:l(()=>[e(S(E),{onClick:D=>re(b,U,K),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0),p.selectedMatchConditionTypes.includes("attachments")&&a.type==="attachments"?(h(),_(y,{key:4,style:{width:"100%"},size:"large",align:"start"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A(a==null?void 0:a.type),1)]),_:2},1024),e(y,{direction:"vertical"},{default:l(()=>[e(i,{type:"primary",onClick:d=>ve(b,U)},{default:l(()=>[g(" 添加attachment ")]),_:2},1032,["onClick"]),e(z,{pagination:!1,columns:pe,"data-source":p.requestMatch[U].list},{bodyCell:l(({column:d,record:u,text:B,index:K})=>[d.key==="myKey"?(h(),_(n,{key:0,value:u.myKey,"onUpdate:value":D=>u.myKey=D,placeholder:"key"},null,8,["value","onUpdate:value"])):d.key==="condition"?(h(),_(R,{key:1,value:u.condition,"onUpdate:value":D=>u.condition=D,options:P.value},null,8,["value","onUpdate:value","options"])):d.key==="value"?(h(),_(n,{key:2,value:u.value,"onUpdate:value":D=>u.value=D,placeholder:"value"},null,8,["value","onUpdate:value"])):d.key==="operation"?(h(),_(y,{key:3,align:"center"},{default:l(()=>[e(S(E),{onClick:D=>ye(b,U,K),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0),p.selectedMatchConditionTypes.includes("other")&&a.type==="other"?(h(),_(y,{key:5,style:{width:"100%"},size:"large",align:"start"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A((a==null?void 0:a.type)=="other"?"其他":a==null?void 0:a.type),1)]),_:2},1024),e(y,{direction:"vertical"},{default:l(()=>[e(i,{type:"primary",onClick:d=>he(b,U)},{default:l(()=>[g(" 添加other ")]),_:2},1032,["onClick"]),e(z,{pagination:!1,columns:Z,"data-source":p.requestMatch[U].list},{bodyCell:l(({column:d,record:u,text:B})=>[d.key==="myKey"?(h(),_(n,{key:0,value:u.myKey,"onUpdate:value":K=>u.myKey=K,placeholder:"key"},null,8,["value","onUpdate:value"])):d.key==="condition"?(h(),_(R,{key:1,value:u.condition,"onUpdate:value":K=>u.condition=K,options:P.value},null,8,["value","onUpdate:value","options"])):d.key==="value"?(h(),_(n,{key:2,value:u.value,"onUpdate:value":K=>u.value=K,placeholder:"value"},null,8,["value","onUpdate:value"])):d.key==="operation"?(h(),_(y,{key:3,align:"center"},{default:l(()=>[e(S(E),{onClick:K=>fe(b,U,u.index),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0)],64))),256))]),_:2},1024)]),_:2},1024)):(h(),_(i,{key:1,onClick:a=>ie(b),type:"dashed",size:"large"},{icon:l(()=>[e(S(E),{icon:"tdesign:add"})]),default:l(()=>[g(" 增加匹配条件 ")]),_:2},1032,["onClick"]))]),_:2},1024),e(c,{label:"路由分发",required:""},{default:l(()=>[e($,null,{default:l(()=>[e(y,{style:{width:"100%"},direction:"vertical",size:"small"},{default:l(()=>[e(f,null,{default:l(()=>[e(c,{label:"匹配条件类型"},{default:l(()=>[e(R,{value:p.selectedRouteDistributeMatchTypes,"onUpdate:value":a=>p.selectedRouteDistributeMatchTypes=a,options:le.value,mode:"multiple",style:{"min-width":"200px"}},null,8,["value","onUpdate:value","options"])]),_:2},1024)]),_:2},1024),(h(!0),x(L,null,X(p.routeDistribute,(a,U)=>(h(),x(L,{key:U},[p.selectedRouteDistributeMatchTypes.includes("host")&&a.type==="host"?(h(),_(y,{key:0,size:"large",align:"center"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A(a==null?void 0:a.type),1)]),_:2},1024),e(R,{value:a.condition,"onUpdate:value":d=>a.condition=d,style:{"min-width":"120px"},options:P.value},null,8,["value","onUpdate:value","options"]),e(n,{value:a.value,"onUpdate:value":d=>a.value=d,placeholder:"请求来源ip"},null,8,["value","onUpdate:value"]),e(S(E),{onClick:d=>ue(a==null?void 0:a.type,b),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),p.selectedRouteDistributeMatchTypes.includes("other")&&a.type==="other"?(h(),_(y,{key:1,style:{width:"100%"},size:"large",align:"start"},{default:l(()=>[e(O,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:l(()=>[g(A((a==null?void 0:a.type)=="other"?"其他":a==null?void 0:a.type),1)]),_:2},1024),e(y,{direction:"vertical"},{default:l(()=>[e(i,{type:"primary",onClick:d=>_e(b,U)},{default:l(()=>[g(" 添加其他 ")]),_:2},1032,["onClick"]),e(z,{pagination:!1,columns:Z,"data-source":p.routeDistribute[U].list},{bodyCell:l(({column:d,record:u,text:B,index:K})=>[d.key==="myKey"?(h(),_(n,{key:0,value:u.myKey,"onUpdate:value":D=>u.myKey=D,placeholder:"key"},null,8,["value","onUpdate:value"])):d.key==="condition"?(h(),_(R,{key:1,value:u.condition,"onUpdate:value":D=>u.condition=D,options:P.value},null,8,["value","onUpdate:value","options"])):d.key==="value"?(h(),_(n,{key:2,value:u.value,"onUpdate:value":D=>u.value=D,placeholder:"value"},null,8,["value","onUpdate:value"])):d.key==="operation"?(h(),_(y,{key:3,align:"center"},{default:l(()=>[e(S(E),{onClick:D=>ke(b,U,K),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),e(i,{onClick:ne,type:"primary"},{default:l(()=>[g(" 增加路由")]),_:1})]),_:1})]),_:1})]),_:1},8,["span"]),e(o,{span:N.value?Y.value:0,class:"right"},{default:l(()=>[N.value?(h(),_($,{key:0,class:"sliderBox"},{default:l(()=>[G("div",null,[e(W,{title:"字段说明",column:1},{default:l(()=>[e(V,{label:"key"},{default:l(()=>[g(" 作用对象"),Ge,g(" 可能的值：Dubbo应用名或者服务名 ")]),_:1}),e(V,{label:"scope"},{default:l(()=>[g(" 规则粒度"),Pe,g(" 可能的值：application, service ")]),_:1}),e(V,{label:"force"},{default:l(()=>[g(" 容错保护"),We,g(" 可能的值：true, false"),me,g(" 描述：如果为true，则路由筛选后若没有可用的地址则会直接报异常；如果为false，则会从可用地址中选择完成RPC调用 ")]),_:1}),e(V,{label:"runtime"},{default:l(()=>[g(" 运行时生效"),Ne,g(" 可能的值：true, false"),xe,g(" 描述：如果为true，则该rule下的所有路由将会实时生效；若为false，则只有在启动时才会生效 ")]),_:1})]),_:1})])]),_:1})):j("",!0)]),_:1},8,["span"])]),_:1}),e($,{class:"footer"},{default:l(()=>[e(f,null,{default:l(()=>[e(i,{type:"primary",onClick:Me},{default:l(()=>[g("确认")]),_:1}),e(i,{style:{"margin-left":"30px"},onClick:t[9]||(t[9]=p=>console.log(r.value))},{default:l(()=>[g(" 取消")]),_:1})]),_:1})]),_:1})])}}}),Xe=Ae(Fe,[["__scopeId","data-v-35945e06"]]);export{Xe as default};
