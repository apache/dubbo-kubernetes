import{d as w,k as b,u as D,r as N,Q as T,w as E,f as _,c as I,t as l,h as p,P as R,s as O,M as q,e as v,o,R as V,J as A,I as L,z as c,B as m,K as u,v as y,Z as P,$,F as B,y as M,m as F,_ as Y}from"./index-vn9A3gdz.js";import{s as U}from"./instance-Pm37AM8e.js";import{S as H,a as J,s as r}from"./SearchUtil-kVsWHfRA.js";import{p as K,q as f}from"./PromQueryUtil-aoQxx6au.js";import{b as Q}from"./ByteUtil-YdHlSEeW.js";import"./request-9tAEjvni.js";const z={class:"instances-container"},G=["onClick"],Z=w({__name:"index",setup(j){b(e=>({"1306439a":p(R)}));let h=D(),g=h.query.query,S=[{title:"instanceDomain.instanceIP",key:"ip",dataIndex:"ip",sorter:(e,t)=>r(e.ip,t.ip),width:200},{title:"instanceDomain.instanceName",key:"name",dataIndex:"name",sorter:(e,t)=>r(e.name,t.name),width:140},{title:"instanceDomain.deployState",key:"deployState",dataIndex:"deployState",width:120,sorter:(e,t)=>r(e.deployState,t.deployState)},{title:"instanceDomain.deployCluster",key:"deployCluster",dataIndex:"deployCluster",sorter:(e,t)=>r(e.deployCluster,t.deployCluster),width:120},{title:"instanceDomain.registerState",key:"registerState",dataIndex:"registerState",sorter:(e,t)=>r(e.registerState,t.registerState),width:120},{title:"instanceDomain.registerCluster",key:"registerClusters",dataIndex:"registerClusters",sorter:(e,t)=>r(e.registerClusters,t.registerClusters),width:140},{title:"instanceDomain.CPU",key:"cpu",dataIndex:"cpu",sorter:(e,t)=>r(e.cpu,t.cpu),width:140},{title:"instanceDomain.memory",key:"memory",dataIndex:"memory",sorter:(e,t)=>r(e.memory,t.memory),width:100},{title:"instanceDomain.startTime_k8s",key:"startTime_k8s",dataIndex:"startTime",sorter:(e,t)=>r(e.startTime,t.startTime),width:200}];function x(e){return U(e).then(async t=>K(t,["cpu","memory"],async s=>{let a=s.ip.split(":")[0],i=await f(`sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{container!=""}) by (pod) * on (pod) group_left(pod_ip)
        kube_pod_info{pod_ip="${a}"}`),C=await f(`sum(container_memory_working_set_bytes{container!=""}) by (pod)
* on (pod) group_left(pod_ip)
kube_pod_info{pod_ip="${a}"}`);s.cpu=O.isNumber(i)?i.toFixed(3)+"u":i,s.memory=Q(C)}))}const n=N(new H([{label:"appName",param:"keywords",defaultValue:g,placeholder:"typeAppName",style:{width:"200px"}}],x,S));return T(()=>{n.tableStyle={scrollY:"calc(100vh - 400px)"},n.onSearch()}),q(F.SEARCH_DOMAIN,n),E(h,(e,t)=>{n.queryForm.keywords=e.query.query,n.onSearch(),console.log(e)}),(e,t)=>{const s=v("a-tag");return o(),_("div",z,[I(J,{"search-domain":n},{bodyCell:l(({text:a,record:i,index:C,column:d})=>[d.dataIndex==="ip"?(o(),_("span",{key:0,class:"app-link",onClick:k=>p(V).push(`/resources/instances/detail/${i.name}/${i[d.key]}`)},[A("b",null,[I(p(L),{style:{"margin-bottom":"-2px"},icon:"material-symbols:attach-file-rounded"}),c(" "+m(a),1)])],8,G)):u("",!0),d.dataIndex==="deployState"?(o(),y(s,{key:1,color:p(P)[a.toUpperCase()]},{default:l(()=>[c(m(a),1)]),_:2},1032,["color"])):u("",!0),d.dataIndex==="deployCluster"?(o(),y(s,{key:2,color:"grey"},{default:l(()=>[c(m(a),1)]),_:2},1024)):u("",!0),d.dataIndex==="registerState"?(o(),y(s,{key:3,color:p($)[a.toUpperCase()]},{default:l(()=>[c(m(a),1)]),_:2},1032,["color"])):u("",!0),d.dataIndex==="registerClusters"?(o(!0),_(B,{key:4},M(a,k=>(o(),y(s,{color:"grey"},{default:l(()=>[c(m(k),1)]),_:2},1024))),256)):u("",!0)]),_:1},8,["search-domain"])])}}}),se=Y(Z,[["__scopeId","data-v-dbffbd74"]]);export{se as default};
