import{d as P,k as O,u as $,b as B,r as h,O as E,a as Q,f as y,c as i,t as r,e as n,h as p,P as N,K as F,o,F as k,x as G,v,I as x,y as S,z as I,H as Y,J as j,m as z,_ as H}from"./index-QTFC1BX7.js";import{g as J,a as K}from"./serverInfo-BXXHVqoB.js";import{S as L,a as U}from"./SearchUtil-gzPkvecP.js";import{b as X}from"./app-AcX83ZGL.js";import"./request-bLCExP-g.js";import{q as w}from"./promQuery-PGswEixs.js";const W={class:"__container_app_service"},Z={class:"statistic-icon-big"},ee=P({__name:"service",setup(ae){O(a=>({a41469aa:p(N)+"22","078fca36":p(N)}));const T=$(),C=B();let c=h({info:{},report:{}}),R=h({info:{}});E(async()=>{d.tableStyle={scrollX:"100",scrollY:"calc(100vh - 600px)"};let a=(await J({})).data;R.info=(await K({})).data,c.info=a,c.report={providers:{icon:"carbon:branch",value:c.info.providers},consumers:{icon:"mdi:merge",value:c.info.consumers}}});const q=[{title:"service",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%"},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],V=Q(()=>{var a;return(a=T.params)==null?void 0:a.pathId});function A(a){return X(a).then(async l=>{var u;let _=(u=l==null?void 0:l.data)==null?void 0:u.list;try{for(let e of _){let m=await w(`sum (dubbo_provider_qps_total{interface='${e.serviceName}'}) by (interface)`),f=await w(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${e.serviceName}",method=~"$method"}>0)`),g=await w(`sum (increase(dubbo_provider_requests_total{interface="${e.serviceName}"}[1m]))`);e.avgQPS=m,e.avgRT=f,e.requestTotal=g,e.versionGroupSelect={},e.versionGroupSelect.versionGroupArr=e.versionGroups.map(t=>t.versionGroup=(t.version?"version: "+t.version+", ":"")+(t.group?"group: "+t.group:"")||"æ— "),e.versionGroupSelect.versionGroupValue=e.versionGroupSelect.versionGroupArr[0]}}catch(e){console.error(e)}return l})}const d=h(new L([{label:"",param:"side",defaultValue:"provider",dict:[{label:"providers",value:"provider"},{label:"consumers",value:"consumer"}],dictType:"BUTTON"},{label:"serviceName",param:"serviceName"},{label:"",param:"appName",defaultValue:V}],A,q,{pageSize:4},!0));d.onSearch();const D=a=>{C.push("/resources/services/detail/"+a)};return F(z.SEARCH_DOMAIN,d),(a,l)=>{const _=n("a-statistic"),u=n("a-flex"),e=n("a-card"),m=n("a-button"),f=n("a-select-option"),g=n("a-select");return o(),y("div",W,[i(u,{wrap:"wrap",gap:"small",vertical:!1,justify:"start",align:"left"},{default:r(()=>[(o(!0),y(k,null,G(p(c).report,(t,s)=>(o(),v(e,{class:"statistic-card"},{default:r(()=>[i(u,{gap:"middle",vertical:!1,justify:"space-between",align:"center"},{default:r(()=>[i(_,{value:t.value,class:"statistic"},{prefix:r(()=>[i(p(x),{class:"statistic-icon",icon:"solar:target-line-duotone"})]),title:r(()=>[S(I(a.$t(s.toString())),1)]),_:2},1032,["value"]),Y("div",Z,[i(p(x),{icon:t.icon},null,8,["icon"])])]),_:2},1024)]),_:2},1024))),256))]),_:1}),i(U,{"search-domain":d},{bodyCell:r(({column:t,text:s})=>[t.dataIndex==="serviceName"?(o(),v(m,{key:0,type:"link",onClick:b=>D(s)},{default:r(()=>[S(I(s),1)]),_:2},1032,["onClick"])):t.dataIndex==="versionGroupSelect"?(o(),v(g,{key:1,value:s.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:r(()=>[(o(!0),y(k,null,G(s.versionGroupArr,(b,M)=>(o(),v(f,{value:b,key:M},{default:r(()=>[S(I(b),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value"])):j("",!0)]),_:1},8,["search-domain"])])}}}),ce=H(ee,[["__scopeId","data-v-4960ab7b"]]);export{ce as default};
