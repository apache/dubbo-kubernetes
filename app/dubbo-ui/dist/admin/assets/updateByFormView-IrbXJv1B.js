import{u as oe}from"./index-37m6CaHp.js";import{d as ne,g as se,u as ue,n as x,r as ie,Q as ce,f as F,c as e,t as a,e as o,o as r,z as u,v as _,h as B,a9 as de,aa as re,F as pe,y as _e,J as f,B as G,I as D,K as A,G as fe,H as ve,_ as ye}from"./index-WfxyH1kR.js";import{e as be,h as me}from"./traffic-jiWu3d0C.js";import"./js-yaml-lTHa-xT-.js";import"./request-2cLtQ4vm.js";const C=R=>(fe("data-v-f473a74b"),R=R(),ve(),R),he={class:"__container_tagRule_detail"},ke=C(()=>f("div",null," 对于服务org.apahe.dubbo.samples.UserService，将满足请求方法等于login，且该方法的第一个参数等于dubbo的请求，导向带有标签version=v1的实例 ",-1)),ge=C(()=>f("br",null,null,-1)),we=C(()=>f("br",null,null,-1)),xe=C(()=>f("br",null,null,-1)),Ce=C(()=>f("br",null,null,-1)),Ue=C(()=>f("br",null,null,-1)),Oe=C(()=>f("br",null,null,-1)),Te={class:"bottom-action-footer"},Ne=ne({__name:"updateByFormView",setup(R){se();const P=ue(),U=x(!1),L=x(8);oe().toClipboard;const n=ie({ruleGranularity:"application",objectOfAction:"shop-user",enable:!0,faultTolerantProtection:!0,runtime:!0,priority:1,configVersion:""}),$=x([{label:"labels",value:"labels"},{label:"addresses",value:"addresses"}]),H=x([{label:"exact",value:"exact"},{label:"regex",value:"regex"},{label:"prefix",value:"prefix"},{label:"noempty",value:"noempty"},{label:"empty",value:"empty"},{label:"wildcard",value:"wildcard"}]),J=x([{label:"=",value:"="},{label:"!=",value:"!="}]),M=x([{title:"键",dataIndex:"myKey",key:"myKey"},{title:"关系",dataIndex:"condition",key:"condition"},{title:"值",dataIndex:"value",key:"value"},{title:"操作",dataIndex:"operation",key:"operation"}]),c=x([]),Q=(i,t)=>{if(c.value[i].scope.labels.length===1){c.value[i].scope.type="addresses";return}c.value[i].scope.labels.splice(t,1)},W=i=>{c.value[i].scope.labels.push({myKey:"",condition:"exact",value:""})},X=()=>{c.value.push({tagName:"",scope:{type:"labels",labels:[{myKey:"",condition:"",value:""}],addresses:{condition:"",addressesStr:""}}})},Y=i=>{c.value.splice(i,1)},E=async()=>{var t;const i=await be((t=P.params)==null?void 0:t.ruleName);if(i.code===200){const{configVersion:b,enabled:O,key:d,runtime:T,scope:m,tags:v}=i==null?void 0:i.data;n.configVersion=b,n.enable=O,n.runtime=T,n.ruleGranularity=m,n.objectOfAction=d,c.value=[],v.forEach((S,y)=>{c.value.push({tagName:S.name,scope:{type:"labels",labels:[],addresses:{condition:"=",addressesStr:""}}});const{match:k}=S;let p=[];k.forEach((s,N)=>{p.push({myKey:s.key,condition:Object.keys(s.value)[0],value:s.value[Object.keys(s.value)[0]]})}),c.value[y]&&c.value[y].scope&&(c.value[y].scope.labels=p)})}},Z=async()=>{var y;const{ruleGranularity:i,objectOfAction:t,enable:b,faultTolerantProtection:O,runtime:d,priority:T,configVersion:m}=n,v={configVersion:m,scope:i,key:t,enabled:b,runtime:d,tags:[]};c.value.forEach((k,p)=>{const s={name:k.tagName,match:[]};k.scope.labels.forEach((N,q)=>{const V={key:N.myKey,value:{}};V.value[N.condition]=N.value,s.match.push(V)}),v.tags.push(s)}),(await me((y=P.params)==null?void 0:y.ruleName,v)).code===200&&await E()};return ce(()=>{E()}),(i,t)=>{const b=o("a-button"),O=o("a-flex"),d=o("a-form-item"),T=o("a-switch"),m=o("a-col"),v=o("a-input"),S=o("a-input-number"),y=o("a-row"),k=o("a-form"),p=o("a-card"),s=o("a-space"),N=o("a-radio-group"),q=o("a-tag"),V=o("a-select"),I=o("a-table"),ee=o("a-textarea"),z=o("a-descriptions-item"),ae=o("a-descriptions"),le=o("a-affix");return r(),F("div",he,[e(O,{style:{width:"100%"}},{default:a(()=>[e(m,{span:U.value?24-L.value:24,class:"left"},{default:a(()=>[e(p,null,{default:a(()=>[e(s,{style:{width:"100%"},direction:"vertical",size:"middle"},{default:a(()=>[e(y,null,{default:a(()=>[e(O,{justify:"end",style:{width:"100%"}},{default:a(()=>[e(b,{type:"text",style:{color:"#0a90d5"},onClick:t[0]||(t[0]=l=>U.value=!U.value)},{default:a(()=>[u(" 字段说明 "),U.value?(r(),_(B(re),{key:1})):(r(),_(B(de),{key:0}))]),_:1})]),_:1}),e(p,{title:"基础信息",style:{width:"100%"},class:"_detail"},{default:a(()=>[e(k,{layout:"horizontal"},{default:a(()=>[e(y,{style:{width:"100%"}},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(d,{label:"规则粒度",required:""},{default:a(()=>[u(" 应用 ")]),_:1}),e(d,{label:"容错保护"},{default:a(()=>[e(T,{checked:n.faultTolerantProtection,"onUpdate:checked":t[1]||(t[1]=l=>n.faultTolerantProtection=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(d,{label:"运行时生效"},{default:a(()=>[e(T,{checked:n.runtime,"onUpdate:checked":t[2]||(t[2]=l=>n.runtime=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(d,{label:"作用对象",required:""},{default:a(()=>[e(v,{disabled:"",value:n.objectOfAction,"onUpdate:value":t[3]||(t[3]=l=>n.objectOfAction=l),style:{width:"200px"}},null,8,["value"])]),_:1}),e(d,{label:"立即启用"},{default:a(()=>[e(T,{checked:n.enable,"onUpdate:checked":t[4]||(t[4]=l=>n.enable=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(d,{label:"优先级"},{default:a(()=>[e(S,{min:"1",value:n.priority,"onUpdate:value":t[5]||(t[5]=l=>n.priority=l)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{title:"标签列表",style:{width:"100%"},class:"_detail"},{default:a(()=>[(r(!0),F(pe,null,_e(c.value,(l,j)=>(r(),_(p,{key:j},{title:a(()=>[e(s,{align:"center"},{default:a(()=>[f("div",null,"路由【"+G(j+1)+"】",1),ke]),_:2},1024)]),default:a(()=>[e(k,{layout:"horizontal"},{default:a(()=>[e(s,{style:{width:"100%"},direction:"vertical",size:"large"},{default:a(()=>[e(O,{justify:"end"},{default:a(()=>[e(B(D),{onClick:g=>Y(j),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024),e(d,{label:"标签名",required:""},{default:a(()=>[e(v,{placeholder:"隔离环境名",value:l.tagName,"onUpdate:value":g=>l.tagName=g},null,8,["value","onUpdate:value"])]),_:2},1024),e(d,{label:"作用范围",required:""},{default:a(()=>[e(p,null,{default:a(()=>[e(s,{style:{width:"100%"},direction:"vertical"},{default:a(()=>[e(d,{label:"匹配条件类型"},{default:a(()=>[e(N,{value:l.scope.type,"onUpdate:value":g=>l.scope.type=g,options:$.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(s,{align:"start",style:{width:"100%"},direction:"horizontal"},{default:a(()=>{var g;return[e(q,{bordered:!1,color:"processing"},{default:a(()=>[u(G(l.scope.type),1)]),_:2},1024),l.scope.type==="labels"?(r(),_(I,{key:0,pagination:!1,columns:M.value,"data-source":(g=l.scope)==null?void 0:g.labels},{bodyCell:a(({column:h,record:K,text:Ke,index:te})=>[h.key==="myKey"?(r(),_(v,{key:0,placeholder:"label key",value:K.myKey,"onUpdate:value":w=>K.myKey=w},null,8,["value","onUpdate:value"])):A("",!0),h.key==="condition"?(r(),_(V,{key:1,value:K.condition,"onUpdate:value":w=>K.condition=w,style:{width:"120px"},options:H.value},null,8,["value","onUpdate:value","options"])):A("",!0),h.key==="value"?(r(),_(v,{key:2,placeholder:"label value",value:K.value,"onUpdate:value":w=>K.value=w},null,8,["value","onUpdate:value"])):h.key==="operation"?(r(),_(s,{key:3,align:"center"},{default:a(()=>[e(B(D),{icon:"tdesign:remove",class:"action-icon",onClick:w=>Q(j,te)},null,8,["onClick"]),e(B(D),{class:"action-icon",icon:"tdesign:add",onClick:w=>W(j)},null,8,["onClick"])]),_:2},1024)):A("",!0)]),_:2},1032,["columns","data-source"])):(r(),_(s,{key:1,align:"start"},{default:a(()=>[e(V,{style:{width:"120px"},value:l.scope.addresses.condition,"onUpdate:value":h=>l.scope.addresses.condition=h,options:J.value},null,8,["value","onUpdate:value","options"]),e(ee,{style:{width:"500px"},value:l.scope.addresses.addressesStr,"onUpdate:value":h=>l.scope.addresses.addressesStr=h,placeholder:'地址列表，如有多个用"，"隔开'},null,8,["value","onUpdate:value"])]),_:2},1024))]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(b,{onClick:X,type:"primary"},{default:a(()=>[u(" 增加标签")]),_:1})]),_:1})]),_:1})]),_:1},8,["span"]),e(m,{span:U.value?L.value:0,class:"right"},{default:a(()=>[U.value?(r(),_(p,{key:0,class:"sliderBox"},{default:a(()=>[f("div",null,[e(ae,{title:"字段说明",column:1},{default:a(()=>[e(z,{label:"key"},{default:a(()=>[u(" 作用对象"),ge,u(" 可能的值：Dubbo应用名或者服务名 ")]),_:1}),e(z,{label:"scope"},{default:a(()=>[u(" 规则粒度"),we,u(" 可能的值：application, service ")]),_:1}),e(z,{label:"force"},{default:a(()=>[u(" 容错保护"),xe,u(" 可能的值：true, false"),Ce,u(" 描述：如果为true，则路由筛选后若没有可用的地址则会直接报异常；如果为false，则会从可用地址中选择完成RPC调用 ")]),_:1}),e(z,{label:"runtime"},{default:a(()=>[u(" 运行时生效"),Ue,u(" 可能的值：true, false"),Oe,u(" 描述：如果为true，则该rule下的所有路由将会实时生效；若为false，则只有在启动时才会生效 ")]),_:1})]),_:1})])]),_:1})):A("",!0)]),_:1},8,["span"])]),_:1}),e(le,{"offset-bottom":10},{default:a(()=>[f("div",Te,[e(s,{align:"center",size:"large"},{default:a(()=>[e(b,{type:"primary",onClick:Z},{default:a(()=>[u(" 确认")]),_:1}),e(b,null,{default:a(()=>[u(" 取消")]),_:1})]),_:1})])]),_:1})])}}}),ze=ye(Ne,[["__scopeId","data-v-f473a74b"]]);export{ze as default};
