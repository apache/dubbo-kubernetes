import{d as T,k as M,u as V,b as A,r as d,Q as D,a as P,f,K as g,c as Q,t as c,h,P as b,M as E,e as t,o,v,z as y,B as S,F as $,y as x,m as B,_ as O}from"./index-3yaHMBuR.js";import{g as F,a as L}from"./serverInfo-LQtk7Nf-.js";import{S as Y,a as z}from"./SearchUtil-x3tT_5M1.js";import{b as K}from"./app-3RL8xbzR.js";import"./request-8fqjBntA.js";import{p as H,q as m}from"./PromQueryUtil-LZegKrD1.js";const J={class:"__container_app_service"},X=T({__name:"service",setup(j){M(r=>({"28ddf99a":h(b)+"22","28a02396":h(b)}));const I=V(),k=A();let s=d({info:{},report:{}}),G=d({info:{}});D(async()=>{n.tableStyle={scrollX:"100",scrollY:"calc(100vh - 600px)"};let r=(await F({})).data;G.info=(await L({})).data,s.info=r,s.report={providers:{icon:"carbon:branch",value:s.info.providers},consumers:{icon:"mdi:merge",value:s.info.consumers}}});const N=[{title:"provideServiceName",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%"},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],w=P(()=>{var r;return(r=I.params)==null?void 0:r.pathId});function q(r){return K(r).then(async _=>H(_,["qps","rt","request"],async a=>{a.versionGroupSelect={},a.versionGroupSelect.versionGroupArr=a.versionGroups.map(e=>e.versionGroup=(e.version?"version: "+e.version+", ":"")+(e.group?"group: "+e.group:"")||"æ— "),a.versionGroupSelect.versionGroupValue=a.versionGroupSelect.versionGroupArr[0];let u=await m(`sum (dubbo_provider_qps_total{interface='${a.serviceName}'}) by (interface)`),l=await m(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${a.serviceName}",method=~"$method"}>0)`),i=await m(`sum (increase(dubbo_provider_requests_total{interface="${a.serviceName}"}[1m]))`);a.avgQPS=u,a.avgRT=l,a.requestTotal=i}))}const n=d(new Y([{label:"serviceName",param:"serviceName"},{label:"",param:"appName",defaultValue:w}],q,N,{pageSize:4},!0));n.onSearch();const C=r=>{k.push("/resources/services/distribution/"+r)};return E(B.SEARCH_DOMAIN,n),(r,_)=>{t("a-statistic"),t("a-flex"),t("a-card");const a=t("a-button"),u=t("a-select-option"),l=t("a-select");return o(),f("div",J,[g("",!0),Q(z,{"search-domain":n},{bodyCell:c(({column:i,text:e})=>[i.dataIndex==="serviceName"?(o(),v(a,{key:0,type:"link",onClick:p=>C(e)},{default:c(()=>[y(S(e),1)]),_:2},1032,["onClick"])):i.dataIndex==="versionGroupSelect"?(o(),v(l,{key:1,value:e==null?void 0:e.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:c(()=>[(o(!0),f($,null,x(e==null?void 0:e.versionGroupArr,(p,R)=>(o(),v(u,{value:p,key:R},{default:c(()=>[y(S(p),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value"])):g("",!0)]),_:1},8,["search-domain"])])}}}),te=O(X,[["__scopeId","data-v-42269320"]]);export{te as default};
