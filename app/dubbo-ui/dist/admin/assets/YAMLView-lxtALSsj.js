import{_ as L}from"./MonacoEditor.vue_vue_type_script_setup_true_lang-JvHrh8S3.js";import{d as R,u as K,n as i,l as P,m as q,Q as z,a as G,r as D,b as H,f as O,c as a,t as e,v as S,K as B,F,e as r,o as v,J as E,y as Q,z as y,X as g,a0 as U,G as X,H as $,_ as W}from"./index-vn9A3gdz.js";import{k as Z,l as aa,m as ea}from"./traffic-yeaU89i2.js";import{y as k}from"./js-yaml-lTHa-xT-.js";import{V as ta}from"./ConfigModel-_nwtbtfs.js";import"./request-9tAEjvni.js";const T=p=>(X("data-v-895c3d7e"),p=p(),$(),p),sa={class:"editorBox"},oa=T(()=>E("p",null,"修改时间: 2024/3/20 15:20:31",-1)),na=T(()=>E("p",null,"版本号: xo842xqpx834",-1)),la=R({__name:"YAMLView",setup(p){const m=K(),C=i(m.params.isEdit==="1"),h=i(!1),x=i(!1),d=i(!1),N=i(8),f=P(q.PROVIDE_INJECT_KEY),n=i(),w=i();z(async()=>{await A()}),G(()=>(console.log(w.value),console.log(JSON.stringify(n.value)),w.value!==JSON.stringify(n.value)));const l=D(new ta);async function A(){var o,t,c;if((o=f.dynamicConfigForm)!=null&&o.data)l.fromData(f.dynamicConfigForm.data);else{if(((t=m.params)==null?void 0:t.pathId)==="_tmp")C.value=!0,h.value=!0,l.basicInfo.ruleName="_tmp";else{h.value=!1;const u=await Z({name:(c=m.params)==null?void 0:c.pathId});l.fromApiOutput(u.data)}f.dynamicConfigForm=D({data:l})}const s=k.dump(l.toApiInput());w.value=JSON.stringify(s),n.value=s}async function J(){d.value=!0;try{f.dynamicConfigForm.data=null,await A(),g.success("config reset success")}finally{d.value=!1}}const b=H();async function M(){var o;d.value=!0;let s=k.load(n.value);try{if(h.value){aa({name:s.ruleName},s).then(c=>{f.dynamicConfigForm.data=null,U(()=>{b.replace("/traffic/dynamicConfig"),g.success("config add success")})}).catch(c=>{g.error("添加失败： "+c.msg)});return}let t=await ea({name:(o=m.params)==null?void 0:o.pathId},s);l.fromApiOutput(t.data),g.success("config save success")}finally{d.value=!1}}function Y(s){l.fromApiOutput(k.load(n.value))}return(s,o)=>{const t=r("a-col"),c=r("a-row"),u=r("a-flex"),_=r("a-button"),V=r("a-card"),j=r("a-spin");return v(),O(F,null,[a(V,null,{default:e(()=>[a(j,{spinning:d.value},{default:e(()=>[a(u,{style:{width:"100%"}},{default:e(()=>[a(t,{span:x.value?24-N.value:24,class:"left"},{default:e(()=>[a(u,{vertical:"",align:"end"},{default:e(()=>[a(c,{style:{width:"100%"},justify:"space-between"},{default:e(()=>[a(t,{span:12}),a(t,{span:12})]),_:1}),E("div",sa,[a(L,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=I=>n.value=I),onChange:Y,theme:"vs-dark",height:"calc(100vh - 450px)",language:"yaml",readonly:!C.value},null,8,["modelValue","readonly"])])]),_:1})]),_:1},8,["span"]),a(t,{span:x.value?N.value:0,class:"right"},{default:e(()=>[x.value?(v(),S(V,{key:0,class:"sliderBox"},{default:e(()=>[(v(),O(F,null,Q(2,I=>a(V,{key:I},{default:e(()=>[oa,na,a(u,{justify:"flex-end"},{default:e(()=>[a(_,{type:"text",style:{color:"#0a90d5"}},{default:e(()=>[y("查看")]),_:1}),a(_,{type:"text",style:{color:"#0a90d5"}},{default:e(()=>[y("回滚")]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):B("",!0)]),_:1},8,["span"])]),_:1})]),_:1},8,["spinning"])]),_:1}),C.value?(v(),S(u,{key:0,style:{"margin-top":"30px"}},{default:e(()=>[a(_,{type:"primary",onClick:M},{default:e(()=>[y("保存")]),_:1}),a(_,{style:{"margin-left":"30px"},onClick:J},{default:e(()=>[y("重置")]),_:1})]),_:1})):B("",!0)],64)}}}),pa=W(la,[["__scopeId","data-v-895c3d7e"]]);export{pa as default};
