import{d as B,k as Q,u as $,b as x,r as g,Q as E,a as O,f as b,c as n,t as r,e as i,h as u,P as w,M as F,o as s,F as N,y as k,v as _,I as G,z as h,B as y,J as L,K as Y,m as j,_ as z}from"./index-_X3VxdTR.js";import{g as J,a as K}from"./serverInfo-xQItbD-w.js";import{S as H,a as U}from"./SearchUtil-ma5G3OR-.js";import{b as X}from"./app-OvjMoHMb.js";import"./request-da1buChK.js";import{p as W,q as S}from"./PromQueryUtil-dybAwPUi.js";const Z={class:"__container_app_service"},ee={class:"statistic-icon-big"},ae=B({__name:"service",setup(te){Q(a=>({"52ae622e":u(w)+"22","66b76d32":u(w)}));const T=$(),q=x();let c=g({info:{},report:{}}),C=g({info:{}});E(async()=>{p.tableStyle={scrollX:"100",scrollY:"calc(100vh - 600px)"};let a=(await J({})).data;C.info=(await K({})).data,c.info=a,c.report={providers:{icon:"carbon:branch",value:c.info.providers},consumers:{icon:"mdi:merge",value:c.info.consumers}}});const R=[{title:"service",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%"},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],V=O(()=>{var a;return(a=T.params)==null?void 0:a.pathId});function M(a){return X(a).then(async I=>W(I,["qps","rt","request"],async e=>{e.versionGroupSelect={},e.versionGroupSelect.versionGroupArr=e.versionGroups.map(o=>o.versionGroup=(o.version?"version: "+o.version+", ":"")+(o.group?"group: "+o.group:"")||"æ— "),e.versionGroupSelect.versionGroupValue=e.versionGroupSelect.versionGroupArr[0];let d=await S(`sum (dubbo_provider_qps_total{interface='${e.serviceName}'}) by (interface)`),v=await S(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${e.serviceName}",method=~"$method"}>0)`),m=await S(`sum (increase(dubbo_provider_requests_total{interface="${e.serviceName}"}[1m]))`);e.avgQPS=d,e.avgRT=v,e.requestTotal=m}))}const p=g(new H([{label:"",param:"side",defaultValue:"provider",dict:[{label:"providers",value:"provider"},{label:"consumers",value:"consumer"}],dictType:"BUTTON"},{label:"serviceName",param:"serviceName"},{label:"",param:"appName",defaultValue:V}],M,R,{pageSize:4},!0));p.onSearch();const A=a=>{q.push("/resources/services/distribution/"+a)};return F(j.SEARCH_DOMAIN,p),(a,I)=>{const e=i("a-statistic"),d=i("a-flex"),v=i("a-card"),m=i("a-button"),o=i("a-select-option"),D=i("a-select");return s(),b("div",Z,[n(d,{wrap:"wrap",gap:"small",vertical:!1,justify:"start",align:"left"},{default:r(()=>[(s(!0),b(N,null,k(u(c).report,(l,t)=>(s(),_(v,{class:"statistic-card"},{default:r(()=>[n(d,{gap:"middle",vertical:!1,justify:"space-between",align:"center"},{default:r(()=>[n(e,{value:l.value,class:"statistic"},{prefix:r(()=>[n(u(G),{class:"statistic-icon",icon:"solar:target-line-duotone"})]),title:r(()=>[h(y(a.$t(t.toString())),1)]),_:2},1032,["value"]),L("div",ee,[n(u(G),{icon:l.icon},null,8,["icon"])])]),_:2},1024)]),_:2},1024))),256))]),_:1}),n(U,{"search-domain":p},{bodyCell:r(({column:l,text:t})=>[l.dataIndex==="serviceName"?(s(),_(m,{key:0,type:"link",onClick:f=>A(t)},{default:r(()=>[h(y(t),1)]),_:2},1032,["onClick"])):l.dataIndex==="versionGroupSelect"?(s(),_(D,{key:1,value:t==null?void 0:t.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:r(()=>[(s(!0),b(N,null,k(t==null?void 0:t.versionGroupArr,(f,P)=>(s(),_(o,{value:f,key:P},{default:r(()=>[h(y(f),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value"])):Y("",!0)]),_:1},8,["search-domain"])])}}}),le=z(ae,[["__scopeId","data-v-6fa20547"]]);export{le as default};
