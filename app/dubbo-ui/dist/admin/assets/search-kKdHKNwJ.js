import{d as A,k as P,b as x,u as D,n as E,r as Q,w as $,f as p,c as S,t as v,h as k,P as B,M as L,e as G,o as c,F as I,z as _,B as m,J as b,I as M,v as q,y as O,K as F,m as J,_ as K}from"./index-WfxyH1kR.js";import{s as Y}from"./service-DC2c1SVC.js";import{S as z,a as H}from"./SearchUtil-nZW97Iet.js";import{p as j,q as h}from"./PromQueryUtil-dnyev3Yo.js";import"./request-2cLtQ4vm.js";const U={class:"__container_services_index"},W=["onClick"],X=A({__name:"search",setup(Z){P(a=>({"2f5b053a":k(B)}));const w=x(),y=D();let C=y.query.query;const N=[{title:"service",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%",ellipsis:!0},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],t=E([]),f=a=>a.map(e=>(e.versionGroupSelect={},e.versionGroupSelect.versionGroupArr=e.versionGroups.map(r=>r.versionGroup=(r.version?"version: "+r.version+", ":"")+(r.group?"group: "+r.group:"")||"无"),e.versionGroupSelect.versionGroupValue=e.versionGroupSelect.versionGroupArr[0],e));function T(a,e){return Y(a).then(async r=>{var n;return t.value=(n=r.data)==null?void 0:n.list,t.value.forEach(o=>{o.selectedIndex=-1}),console.log(t.value),j(r,["avgQPS","avgRT","requestTotal"],async o=>{o.avgQPS=await h(`sum (dubbo_provider_qps_total{interface='${o.serviceName}'}) by (interface)`),o.avgRT=await h(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${o.serviceName}",method=~"$method"}>0)`),o.requestTotal=await h(`sum (increase(dubbo_provider_requests_total{interface="${o.serviceName}"}[1m]))`)})})}const u=Q(new z([{label:"serviceName",param:"keywords",placeholder:"typeAppName",defaultValue:C,style:{width:"200px"}}],T,N,void 0,void 0,f));u.onSearch(f);const V=(a,e,r)=>{r==="无"?t.value[a].selectedIndex=-1:t.value[a].selectedIndex=e},R=(a,e)=>{var l,s,i;const r=(l=t.value[e])==null?void 0:l.selectedIndex,n=((s=t.value[e].versionGroups[r])==null?void 0:s.group)||"",o=((i=t.value[e].versionGroups[r])==null?void 0:i.version)||"";w.push({name:"distribution",params:{pathId:a,group:n,version:o}})};return L(J.SEARCH_DOMAIN,u),$(y,(a,e)=>{u.queryForm.keywords=a.query.query,u.onSearch(),console.log(a)}),(a,e)=>{const r=G("a-select-option"),n=G("a-select");return c(),p("div",U,[S(H,{"search-domain":u},{bodyCell:v(({column:o,record:l,text:s,index:i})=>[o.dataIndex==="serviceName"?(c(),p(I,{key:0},[_(m(l.versionGroup)+" ",1),b("span",{class:"service-link",onClick:d=>R(s,i)},[b("b",null,[S(k(M),{style:{"margin-bottom":"-2px"},icon:"material-symbols:attach-file-rounded"}),_(" "+m(s),1)])],8,W)],64)):o.dataIndex==="versionGroupSelect"?(c(),q(n,{key:1,value:s==null?void 0:s.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:v(()=>[(c(!0),p(I,null,O(s==null?void 0:s.versionGroupArr,(d,g)=>(c(),q(r,{value:d,onClick:ee=>V(i,g,d),key:g},{default:v(()=>[_(m(d),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1032,["value"])):F("",!0)]),_:1},8,["search-domain"])])}}}),ne=K(X,[["__scopeId","data-v-94fe6178"]]);export{ne as default};
