{{ $nacos := .Values.nacos }}
{{ $zookeeper := .Values.zookeeper }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: admin-config
  namespace: {{ .Release.Namespace }}
  labels:
    app: admin
    dubbo.io/rev: {{ default "default" | quote }}
    install.operator.dubbo.io/owning-resource: {{ default "unknown" }}
    operator.dubbo.io/component: "Admin"
    dubbo: admin
    release: {{ .Release.Name }}
    app.kubernetes.io/name: "dashboard"
data:
  dubbo-cp.yaml: |-
    deployMode: {{ .Values.deployMode }}
    mode: {{ .Values.mode }}
    store:
      {{- if $nacos.enabled }}
      # Traditional Store support nacos and zookeeper
      traditional:
        registry:
          address: {{ .Values.nacosAddress }}
        configCenter:
          address: {{ .Values.nacosAddress }}
        metadataReport:
          address: {{ .Values.nacosAddress }}
      {{- end }}
      {{- if $zookeeper.enabled }}
      traditional:
        registry:
          address: {{ .Values.zookeeperAddress }}
        configCenter:
          address: {{ .Values.zookeeperAddress }}
        metadataReport:
          address: {{ .Values.zookeeperAddress }}
      {{- end }}
    admin:
      # metric and trace grafana dashboards
      metricDashboards:
        application:
          baseURL: {{ .Values.grafanaAddress }}/d/a0b114ca-edf7-4dfe-ac2c-34a4fc545fed/application
        instance:
          baseURL: {{ .Values.grafanaAddress }}/d/dcf5defe-d198-4704-9edf-6520838880e9/instance
        service:
          baseURL: {{ .Values.grafanaAddress }}/d/ec689613-b4a1-45b1-b8bd-9d557059f970/service/
      traceDashboards:
        application:
          baseURL: {{ .Values.grafanaAddress }}/d/e968a89b-f03d-42e3-8ad3-930ae815cb0f/application
        instance:
          baseURL: {{ .Values.grafanaAddress }}/d/f5f48f75-13ec-489b-88ae-635ae38d8618/instance
        service:
          baseURL: {{ .Values.grafanaAddress }}/d/b2e178fb-ada3-4d5e-9f54-de99e7f07662/service
      prometheus: {{ .Values.prometheusAddress }}
      # grafana should custom configs below:
      # [server]
      # root_url = %(protocol)s://%(domain)sï¼š%(http_port)s/grafana
      # allowed_origins = *
      # serve_from_sub_path = true
      # [security]
      # allow_embedding = true
      # [auth.anonymous]
      # enabled = true
      grafana: {{ .Values.grafana }}
      auth:
        user: {{ .Values.user }}
        password: {{ .Values.password }}
        expirationTime: {{ .Values.expirationTime }}