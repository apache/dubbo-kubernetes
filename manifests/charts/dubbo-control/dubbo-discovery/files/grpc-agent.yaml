metadata:
  annotations: {}
spec:
  containers:
    - name: dubbo-proxy
  image: "proxyxds"
  ports:
    - containerPort: 15020
      protocol: TCP
      name: mesh-metrics
  args:
    - proxy
  lifecycle:
    postStart:
      exec:
        command:
        - sail-agent
        - wait
        - --url=http://localhost:15020/healthz/ready
  env:
  - name: SAIL_META_GENERATOR
    value: grpc
  - name: OUTPUT_CERTS
    value: /var/lib/dubbo/data
  readinessProbe:
    httpGet:
      path: /healthz/ready
      port: 15020
    initialDelaySeconds: 0
    periodSeconds: 15
    timeoutSeconds: 3
    failureThreshold: 4
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 2000m
      memory: 1024Mi
  volumeMounts:
  - name: workload-socket
    mountPath: /var/run/secrets/workload-spiffe-uds
  - name: workload-certs
    mountPath: /var/run/secrets/workload-spiffe-credentials
  - name: dubbod-ca-cert
    mountPath: /var/run/secrets/dubbo
  - name: dubbo-data
    mountPath: /var/lib/dubbo/data
  # UDS channel between istioagent and gRPC client for XDS/SDS
  - mountPath: /etc/dubbo/proxy
    name: dubbo-xds
  - mountPath: /var/run/secrets/tokens
    name: dubbo-token
  - mountPath: /etc/certs/
    name: dubbo-certs
    readOnly: true
  - name: dubbo-podinfo
    mountPath: /etc/dubbo/pod
- name: dubbo-proxy
  env:
    - name: "GRPC_XDS_EXPERIMENTAL_SECURITY_SUPPORT"
      value: "true"
    - name: "GRPC_XDS_BOOTSTRAP"
      value: "/etc/dubbo/proxy/grpc-bootstrap.json"
  volumeMounts:
    - mountPath: /var/lib/dubbo/data
      name: dubbo-data
    # UDS channel between dubboagent and gRPC client for XDS/SDS
    - mountPath: /etc/dubbo/proxy
      name: dubbo-xds
    - mountPath: /var/run/secrets/workload-spiffe-credentials
      name: workload-certs